<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NPM379XLP7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NPM379XLP7');
</script>
    <title>Calculadora Donatte Detalle</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        /* --- ESTILOS DE MARCA DONATTE --- */
        :root {
            --rosa-brand: #ff5983;
            --rosa-claro: #ffebee;
            --menta-brand: #26c6da;
            --verde-venta: #2e7d32; /* Verde elegante para la venta */
            --rojo-costo: #880e4f;  /* Color vino para Costo Total */
            --fondo: #fff5f8;
            --cafe-texto: #4e342e;
            --blanco: #ffffff;
        }

        body { 
            font-family: 'Poppins', sans-serif; 
            background-color: var(--fondo);
            color: var(--cafe-texto); 
            margin: 0; padding: 20px; 
            font-size: 13px;
        }
        
        h1 { text-align: center; color: var(--rosa-brand); margin-bottom: 20px; font-weight: 700; font-size: 24px; text-transform: uppercase; letter-spacing: 1px;}
        h3 { color: var(--menta-brand); font-size: 14px; font-weight: 600; margin-top: 15px; margin-bottom: 10px; border-bottom: 2px dashed #ffe0e9; padding-bottom: 5px;}
        h4 { color: var(--rosa-brand); margin-top: 0; text-align: center; font-size: 15px;}
        
        .container { display: flex; flex-wrap: wrap; gap: 15px; max-width: 900px; margin: 0 auto; }
        
        .card { 
            background: var(--blanco); padding: 20px; border-radius: 20px; 
            box-shadow: 0 10px 25px rgba(255, 89, 131, 0.08); border: 1px solid #fff0f5;
        }
        
        .left-panel { flex: 2; min-width: 320px; } 
        .right-panel { flex: 1; min-width: 240px; background-color: #f0fbfc; border: 1px dashed var(--menta-brand); height: fit-content; } 
        .bottom-panel { width: 100%; margin-top: 10px; }

        label { display: block; margin-top: 10px; font-weight: 600; color: #8d6e63; font-size: 11px;}
        input { 
            width: 100%; padding: 8px 12px; margin-top: 3px; border: 2px solid #fce4ec; 
            border-radius: 12px; box-sizing: border-box; font-size: 13px; font-family: inherit; color: var(--cafe-texto);
            transition: all 0.2s; background: #fffdfd;
        }
        input:focus { outline: none; border-color: var(--rosa-brand); background-color: #fff; }
        
        .row { display: flex; gap: 8px; align-items: center; margin-bottom: 5px; }
        .col-50 { width: 50%; }
        
        button { cursor: pointer; transition: 0.2s; font-family: inherit; border: none; font-weight: 600;}
        
        .btn-main { 
            width: 100%; padding: 12px; border-radius: 50px; font-size: 14px; color: white; margin-top: 15px;
            background: linear-gradient(45deg, var(--rosa-brand), #ff8fa9); 
            box-shadow: 0 4px 15px rgba(255, 89, 131, 0.3);
        }
        .btn-main:hover { transform: translateY(-2px); }

        .btn-small { padding: 5px 10px; border-radius: 8px; font-size: 11px; }
        .btn-add { background-color: #e0f7fa; color: var(--menta-brand); margin-top: 8px; width: 100%;}
        .btn-remove { background-color: #ffebee; color: #ff5252; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center;}
        
        .btn-aux { width: 100%; padding: 8px; background-color: var(--menta-brand); color: white; border-radius: 10px; margin-top: 10px; font-size: 12px;}
        
        .btn-save { background-color: #81c784; color: white; width: 48%; padding: 10px; border-radius: 12px; font-weight: 600;}
        .btn-download { background-color: #ba68c8; color: white; width: 48%; padding: 10px; border-radius: 12px; font-weight: 600;}
        .action-row { display: flex; justify-content: space-between; margin-top: 15px; }

        /* --- NUEVO ESTILO DEL RESULTADO (Tipo Lista) --- */
        .result-area { 
            background-color: #f3e5f5; /* Un lila muy suave o usar var(--rosa-claro) */
            background-color: var(--rosa-claro);
            padding: 20px; 
            border-radius: 15px; 
            margin-top: 20px; 
            border: 1px solid #ffcdd2; 
        }

        .res-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 13px;
            color: var(--cafe-texto);
        }
        
        .res-bold { font-weight: 600; }
        
        .res-costo-total {
            color: var(--rojo-costo);
            font-weight: 700;
            margin-top: 5px;
        }

        .res-divider {
            height: 1px;
            border-top: 1px dashed #999;
            margin: 12px 0;
            opacity: 0.5;
        }

        .res-final {
            text-align: center;
            font-size: 22px; /* Tama√±o controlado, no gigante */
            font-weight: 700;
            color: var(--verde-venta);
        }
        
        /* Tabla Historial */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; color: #aaa; font-size: 10px; padding: 8px; font-weight: 600;}
        td { padding: 10px 8px; border-bottom: 1px solid #f0f0f0; font-size: 12px; color: var(--cafe-texto);}
        
        /* Ticket Oculto */
        #ticketArea {
            position: absolute; left: -9999px; top: 0; 
            width: 400px; background: white; padding: 30px;
            border-top: 15px solid var(--rosa-brand);
            font-family: 'Poppins', sans-serif; color: var(--cafe-texto); box-sizing: border-box;
        }

    </style>
</head>
<body>

<h1>üç© Calculadora Donatte</h1>

<div class="container">
    
    <div class="card left-panel">
        <h3 style="margin-top:0; border:none; color:var(--rosa-brand);">1. Datos del Pedido</h3>
        <label>üíñ Nombre del Proyecto:</label>
        <input type="text" id="inpNombre" placeholder="Ej: Agenda Personalizada">

        <label>üí∞ Precio de tu hora ($):</label>
        <input type="number" id="inpHora" placeholder="Ej: 5000" value="5000">

        <h3>2. Materiales</h3>
        <div id="listaMateriales">
            <div class="row mat-item">
                <input type="text" class="m-nom" placeholder="Ej: 10 hojas A4">
                <input type="number" class="m-val" placeholder="$ Costo">
            </div>
        </div>
        <button class="btn-small btn-add" onclick="nuevoMaterial()">+ Agregar otro material</button>

        <h3>3. Tiempo y Dise√±o</h3>
        <div class="row">
            <div class="col-50">
                <label>‚è±Ô∏è Minutos trabajados:</label>
                <input type="number" id="inpMinutos" placeholder="Ej: 45">
            </div>
            <div class="col-50">
                <label>üé® Costo Dise√±o ($):</label>
                <input type="number" id="inpDiseno" placeholder="Ej: 1500">
            </div>
        </div>

        <h3>4. Rentabilidad</h3>
        <label>üìà Porcentaje Ganancia (%):</label>
        <input type="number" id="inpGanancia" value="35">

        <button class="btn-main" onclick="calcular()">CALCULAR PRECIO FINAL</button>

        <div id="boxResultado" class="result-area" style="display:none;">
            
            <div class="res-row">
                <span>Materiales:</span>
                <span id="txtMat">$0.00</span>
            </div>
            <div class="res-row">
                <span>Mano de Obra:</span>
                <span id="txtMano">$0.00</span>
            </div>
            <div class="res-row">
                <span>Dise√±o:</span>
                <span id="txtDiseno">$0.00</span>
            </div>
            
            <div class="res-row res-costo-total">
                <span>COSTO TOTAL:</span>
                <span id="txtCosto">$0.00</span>
            </div>
            
            <div class="res-row">
                <span>Ganancia:</span>
                <span id="txtGanancia">$0.00</span>
            </div>

            <div class="res-divider"></div>

            <div class="res-final">
                VENTA: <span id="txtTotal">$0.00</span>
            </div>
            
            <div class="action-row">
                <button class="btn-save" id="btnGuardar" onclick="guardar()">üíæ Guardar</button>
                <button class="btn-download" onclick="descargarImagen()">üì∏ Descargar</button>
            </div>
        </div>
    </div>

    <div class="card right-panel">
        <h4>üç¨ Calc. R√°pida</h4>
        <p style="font-size:10px; text-align:center; color:#888;">Unitarios sin salir.</p>
        <label>Precio Paquete ($):</label>
        <input type="number" id="auxPrecio" placeholder="Ej: 12000">
        <label>Cantidad que trae:</label>
        <input type="number" id="auxCant" placeholder="Ej: 500">
        <button class="btn-aux" onclick="calcUnitario()">1. Sacar Unitario</button>
        <div id="resUnitario" style="text-align:center; margin-top:8px; font-weight:700; color: var(--menta-brand); display:none; font-size: 14px;"></div>
        <hr style="border: 0; border-top: 1px dashed #b2dfdb; margin: 15px 0;">
        <label>¬øCu√°ntas usaste?</label>
        <input type="number" id="auxUsadas" placeholder="Ej: 8">
        <button class="btn-aux" style="background:#4db6ac;" onclick="calcTotalMat()">2. Calcular Total</button>
        <div id="resTotalMat" style="text-align:center; margin-top:8px; font-weight:700; color: var(--rosa-brand); font-size:16px; display:none;"></div>
    </div>

    <div class="card bottom-panel">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3 style="margin:0; color: #8d6e63; border:none;">üìÇ Historial</h3>
            <button class="btn-small" style="background:#f1f1f1; color:#999;" onclick="borrarTodo()">Limpiar</button>
        </div>
        <table id="tablaHistorial">
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Proyecto</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody id="bodyHistorial"></tbody>
        </table>
        <button onclick="reiniciarFabrica()" style="background:none; border:none; color:#ddd; font-size:10px; width:100%; margin-top:20px;">Reiniciar App</button>
    </div>

</div>

<div id="ticketArea">
    <div style="text-align:center; margin-bottom:20px;">
        <p style="font-size:22px; font-weight:bold; color:#ff5983; margin:0; text-transform:uppercase;">Donatte Donut</p>
        <p style="font-size:14px; color:#888;">Presupuesto</p>
    </div>
    <div style="background:#fff5f8; padding:10px; border-radius:10px; margin-bottom:20px; text-align:center; font-weight:600;">
        <span id="ticketCliente">---</span>
    </div>
    
    <div class="res-row"><span>Materiales:</span> <span id="ticketMat">$0</span></div>
    <div class="res-row"><span>Mano de Obra:</span> <span id="ticketMano">$0</span></div>
    <div class="res-row"><span>Dise√±o:</span> <span id="ticketDiseno">$0</span></div>
    <div class="res-divider"></div>
    <div class="res-final" id="ticketTotalFinal">$0</div>
    
    <div style="text-align:center; font-size:12px; margin-top:20px; color:#aaa;">¬°Gracias por tu confianza!</div>
</div>

<script>
    // --- L√ìGICA V9 ---
    let ultimoTotal = 0;
    let costoUnitarioTemp = 0;
    let datosParaTicket = {};

    function getNum(id) {
        let val = document.getElementById(id).value;
        if(val === "" || val === null) return 0;
        return parseFloat(val);
    }

    function nuevoMaterial() {
        let div = document.createElement("div");
        div.className = "row mat-item";
        div.innerHTML = `
            <input type="text" class="m-nom" placeholder="Material">
            <input type="number" class="m-val" placeholder="$">
            <button class="btn-remove" onclick="this.parentElement.remove()">‚úï</button>
        `;
        document.getElementById("listaMateriales").appendChild(div);
    }

    function calcular() {
        try {
            // 1. Sumar Materiales
            let totalMat = 0;
            document.querySelectorAll(".m-val").forEach(inp => {
                if(inp.value) totalMat += parseFloat(inp.value);
            });

            // 2. Calcular otros costos
            let valorHora = getNum("inpHora");
            let minutos = getNum("inpMinutos");
            let costoMano = (valorHora / 60) * minutos;
            let diseno = getNum("inpDiseno");
            let gananciaPorc = getNum("inpGanancia");

            // 3. Totales
            let costoPuro = totalMat + costoMano + diseno;
            let gananciaDinero = costoPuro * (gananciaPorc / 100);
            let precioFinal = costoPuro + gananciaDinero;

            ultimoTotal = precioFinal;

            // 4. MOSTRAR EN PANTALLA (Detallado)
            document.getElementById("txtMat").innerText = "$" + totalMat.toFixed(2);
            document.getElementById("txtMano").innerText = "$" + costoMano.toFixed(2);
            document.getElementById("txtDiseno").innerText = "$" + diseno.toFixed(2);
            document.getElementById("txtCosto").innerText = "$" + costoPuro.toFixed(2);
            document.getElementById("txtGanancia").innerText = "$" + gananciaDinero.toFixed(2);
            document.getElementById("txtTotal").innerText = "$" + precioFinal.toFixed(2);

            document.getElementById("boxResultado").style.display = "block";
            
            // Guardar datos para Ticket y Historial
            datosParaTicket = {
                nombre: document.getElementById("inpNombre").value || "Sin Nombre",
                mat: totalMat,
                mano: costoMano,
                diseno: diseno,
                total: precioFinal
            };

        } catch (error) { alert("Error: " + error.message); }
    }

    // --- DESCARGAR ---
    function descargarImagen() {
        document.getElementById("ticketCliente").innerText = datosParaTicket.nombre;
        document.getElementById("ticketMat").innerText = "$" + datosParaTicket.mat.toFixed(2);
        document.getElementById("ticketMano").innerText = "$" + datosParaTicket.mano.toFixed(2);
        document.getElementById("ticketDiseno").innerText = "$" + datosParaTicket.diseno.toFixed(2);
        document.getElementById("ticketTotalFinal").innerText = "$" + datosParaTicket.total.toFixed(2);

        const ticket = document.getElementById("ticketArea");
        ticket.style.position = "fixed"; 
        ticket.style.left = "0";
        ticket.style.zIndex = "-1"; 

        html2canvas(ticket).then(canvas => {
            let link = document.createElement('a');
            link.download = 'Presupuesto-Donatte.png';
            link.href = canvas.toDataURL("image/png");
            link.click();
            ticket.style.position = "absolute";
            ticket.style.left = "-9999px";
        });
    }

    // --- AUXILIAR ---
    function calcUnitario() {
        let p = getNum("auxPrecio");
        let c = getNum("auxCant");
        if (c === 0) c = 1;
        costoUnitarioTemp = p / c;
        let div = document.getElementById("resUnitario");
        div.innerText = "$" + costoUnitarioTemp.toFixed(2) + " c/u";
        div.style.display = "block";
    }

    function calcTotalMat() {
        if(costoUnitarioTemp === 0) calcUnitario();
        let usadas = getNum("auxUsadas");
        let total = costoUnitarioTemp * usadas;
        let div = document.getElementById("resTotalMat");
        div.innerText = "Total: $" + total.toFixed(2);
        div.style.display = "block";
    }

    // --- HISTORIAL ---
    function guardar() {
        let nombre = document.getElementById("inpNombre").value || "Sin Nombre";
        let fecha = new Date().toLocaleDateString();
        let nuevoItem = { id: Date.now(), fecha: fecha, nombre: nombre, total: ultimoTotal };

        let historial = [];
        let guardado = localStorage.getItem("appDonatte_v3");
        if(guardado) { try { historial = JSON.parse(guardado); } catch(e) {} }

        historial.unshift(nuevoItem);
        localStorage.setItem("appDonatte_v3", JSON.stringify(historial));

        let btn = document.getElementById("btnGuardar");
        btn.innerText = "¬°Listo! üíæ";
        setTimeout(() => { btn.innerText = "üíæ Guardar"; }, 2000);
        cargarTabla();
    }

    function cargarTabla() {
        let tbody = document.getElementById("bodyHistorial");
        tbody.innerHTML = "";
        let guardado = localStorage.getItem("appDonatte_v3");
        if(!guardado) return;
        let historial = JSON.parse(guardado);
        historial.forEach((item) => {
            let tr = document.createElement("tr");
            tr.innerHTML = `<td>${item.fecha}</td><td>${item.nombre}</td><td style="font-weight:700; color:#ff5983;">$${item.total.toFixed(2)}</td>`;
            tbody.appendChild(tr);
        });
    }

    function borrarTodo() {
        if(confirm("¬øBorrar historial?")) { localStorage.removeItem("appDonatte_v3"); cargarTabla(); }
    }
    function reiniciarFabrica() {
        if(confirm("¬øResetear?")) { localStorage.clear(); location.reload(); }
    }
    cargarTabla();
</script>

</body>
</html>

